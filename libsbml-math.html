<!-- HTML header for Doxygen -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>libSBML C++ API: Working with math</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="sbml.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="libsbml-doxygen-stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libSBML C++ API
   &#160;<span id="projectnumber">5.19.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('libsbml-math.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Working with math </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#math-overview">Basic concepts</a></li>
<li class="level1"><a href="#math-convert">Converting between ASTs and text strings</a></li>
</ul>
</div>
<div class="textblock"><p>This section describes libSBML's facilities for working with SBML representations of mathematical expressions.</p>
<p>Internally, libSBML uses <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank">Abstract Syntax Trees</a> (ASTs) to provide a canonical, in-memory representation for all mathematical formulas regardless of their original format (i.e., C-like infix text strings or the XML-based <a href="http://www.w3.org/TR/MathML2/" target="_blank">MathML&#160;2.0</a> format). LibSBML provides an extensive API for working with ASTs; it also provides facilities for translating between ASTs and mathematical formulas writing in a text-string notation, as well as translating between ASTs and MathML.</p>
<h1><a class="anchor" id="math-overview"></a>
Basic concepts</h1>
<dl class="section user"><dt></dt><dd>An AST <em>node</em> in libSBML is a recursive tree structure; each node has a type, a pointer to a value, and a list of children nodes. Each <a class="el" href="class_a_s_t_node.html" title="\ @ @ . () mathematical expression.">ASTNode</a> node may have none, one, two, or more children depending on its type. There are node types to represent numbers (with subtypes to distinguish integer, real, and rational numbers), names (e.g., constants or variables), simple mathematical operators, logical or relational operators and functions. The following diagram illustrates an example of how the mathematical expression <code>"1 + 2"</code> is represented as an AST with one <em>plus</em> node having two <em>integer</em> children nodes for the numbers <code>1</code> and <code>2</code>. The figure also shows the corresponding MathML representation:</dd></dl>
<table border="0" class="centered text-table width80 normal-font" style="padding-bottom: 0.5em">
<caption class="top-caption">Example AST representation of a mathematical expression.</caption>
<tr>
<th width="50px">Infix</th>
<th>AST</th>
<th>MathML</th>
</tr>
<tr>
<td valign="middle" align="center">
<code>1 + 2</code>
</td>
<td valign="middle">
  <object type="image/svg+xml" data="simple-ast.svg" class="centered" width="140px"></object>
</td>
<td valign="middle">
<code>&lt;math xmlns="http://www.w3.org/1998/Math/MathML"&gt;</code><br>
<code>&nbsp;&nbsp;&lt;apply&gt;</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;plus/&gt;</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;cn type="integer"&gt; 1 &lt;/cn&gt;</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;cn type="integer"&gt; 2 &lt;/cn&gt;</code><br>
<code>&nbsp;&nbsp;&lt;/apply&gt;</code><br>
<code>&lt;/math&gt;</code>
</td>
</tr>
</table>
<p>The following are other noteworthy points about the AST representation in libSBML:</p>
<ul>
<li>A numerical value represented in MathML as a real number with an exponent is preserved as such in the AST node representation, even if the number could be stored in a <code>double</code> data type. This is done so that when an SBML model is read in and then written out again, the amount of change introduced by libSBML to the SBML during the round-trip activity is minimized.</li>
</ul>
<ul>
<li>Rational numbers are represented in an AST node using separate numerator and denominator values. These can be retrieved using the methods <a class="el" href="class_a_s_t_node.html#a17a4868804e7e10a6cf79430723a4aee" title="Returns the value of the numerator of this node if of type AST_RATIONAL, or the numerical value of th...">ASTNode::getNumerator()</a> and <a class="el" href="class_a_s_t_node.html#a620072b6b11a6c83943ecdfa4385f6d6" title="Returns the value of the denominator of this node.">ASTNode::getDenominator()</a>.</li>
</ul>
<ul>
<li>The children of an <a class="el" href="class_a_s_t_node.html" title="\ @ @ . () mathematical expression.">ASTNode</a> are other <a class="el" href="class_a_s_t_node.html" title="\ @ @ . () mathematical expression.">ASTNode</a> objects. The list of children is empty for nodes that are leaf elements, such as numbers. For nodes that are actually roots of expression subtrees, the list of children points to the parsed objects that make up the rest of the expression.</li>
</ul>
<p>For many applications, the details of ASTs are irrelevant because libSBML provides text-string based translation functions such as <a class="el" href="_l3_formula_formatter_8h.html#a3ee99a0498b6249f6602b98be6733b19" title="Converts an AST to a string representation of a formula using a syntax derived from SBML Level&#160;1,...">SBML_formulaToL3String()</a></p>
<h1><a class="anchor" id="math-convert"></a>
Converting between ASTs and text strings</h1>
<p>SBML Levels 2 and 3 represent mathematical expressions using using <a href="http://www.w3.org/Math/">MathML&#160;2.0</a> (more specifically, a subset of the <em>content</em> portion of MathML&#160;2.0), but most applications using libSBML do not use MathML directly. Instead, applications generally interact with mathematics using either the API for Abstract Syntax Trees (described below), or using libSBML's facilities for encoding and decoding mathematical formulas to/from text strings. The latter is simpler to use directly, so we describe it first.</p>
<p>The libSBML formula parser has been carefully engineered so that transformations from MathML to the libSBML infix text notation <em>and back</em> is possible with a minimum of disruption to the structure of the mathematical expression. The example below shows a simple program that, when run, takes a MathML string compiled into the program, converts it to an AST, converts <em>that</em> to an infix representation of the formula, compares it to the expected form of that formula, and finally translates that formula back to MathML and displays it. The output displayed on the terminal should have the same structure as the MathML it started with. The program is a simple example of using libSBML's basic MathML and AST reading and writing methods, and shows that libSBML preserves the ordering and structure of the mathematical expressions.</p>
<p><a class="anchor" id="example-program"></a> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_s_b_m_l_types_8h.html">sbml/SBMLTypes.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* expected = <span class="stringliteral">&quot;1 + f(x)&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* s = <span class="stringliteral">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;&lt;math xmlns=&#39;http://www.w3.org/1998/Math/MathML&#39;&gt;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;  &lt;apply&gt; &lt;plus/&gt; &lt;cn&gt; 1 &lt;/cn&gt;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;                  &lt;apply&gt; &lt;ci&gt; f &lt;/ci&gt; &lt;ci&gt; x &lt;/ci&gt; &lt;/apply&gt;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;  &lt;/apply&gt;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;&lt;/math&gt;&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="class_a_s_t_node.html">ASTNode</a>* ast    = <a class="code" href="_math_m_l_8cpp.html#a0fb4f7430eb05834379253ce3611a00a">readMathMLFromString</a>(s);</div>
<div class="line">  <span class="keywordtype">char</span>*    result = <a class="code" href="_l3_formula_formatter_8h.html#a3ee99a0498b6249f6602b98be6733b19">SBML_formulaToL3String</a>(ast);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> ( strcmp(result, expected) == 0 )</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Got expected result&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Mismatch after readMathMLFromString()&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="class_a_s_t_node.html">ASTNode</a>* new_mathml = <a class="code" href="_l3_parser_8cpp.html#a58e584e7c21801b34d79fed7a7c05ac8">SBML_parseL3Formula</a>(result);</div>
<div class="line">  <span class="keywordtype">char</span>*    new_s      = <a class="code" href="_math_m_l_8cpp.html#a539b72bb51b93224ed973436a4add6a4">writeMathMLToString</a>(new_mathml);</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Result of writing AST:&quot;</span> &lt;&lt; std::endl &lt;&lt; new_s &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="a_l3_formula_formatter_8h_html_a3ee99a0498b6249f6602b98be6733b19"><div class="ttname"><a href="_l3_formula_formatter_8h.html#a3ee99a0498b6249f6602b98be6733b19">SBML_formulaToL3String</a></div><div class="ttdeci">char * SBML_formulaToL3String(const ASTNode_t *tree)</div><div class="ttdoc">Converts an AST to a string representation of a formula using a syntax derived from SBML Level&amp;#160;1,...</div></div>
<div class="ttc" id="a_l3_parser_8cpp_html_a58e584e7c21801b34d79fed7a7c05ac8"><div class="ttname"><a href="_l3_parser_8cpp.html#a58e584e7c21801b34d79fed7a7c05ac8">SBML_parseL3Formula</a></div><div class="ttdeci">ASTNode_t * SBML_parseL3Formula(const char *formula)</div><div class="ttdoc">Parses a text string as a mathematical formula and returns an AST representation of it.</div><div class="ttdef"><b>Definition:</b> L3Parser.cpp:3235</div></div>
<div class="ttc" id="a_math_m_l_8cpp_html_a0fb4f7430eb05834379253ce3611a00a"><div class="ttname"><a href="_math_m_l_8cpp.html#a0fb4f7430eb05834379253ce3611a00a">readMathMLFromString</a></div><div class="ttdeci">ASTNode_t * readMathMLFromString(const char *xml)</div><div class="ttdoc">Reads the MathML from the given XML string, constructs a corresponding abstract syntax tree,...</div><div class="ttdef"><b>Definition:</b> MathML.cpp:2250</div></div>
<div class="ttc" id="a_math_m_l_8cpp_html_a539b72bb51b93224ed973436a4add6a4"><div class="ttname"><a href="_math_m_l_8cpp.html#a539b72bb51b93224ed973436a4add6a4">writeMathMLToString</a></div><div class="ttdeci">char * writeMathMLToString(const ASTNode *node)</div><div class="ttdef"><b>Definition:</b> MathML.cpp:2405</div></div>
<div class="ttc" id="a_s_b_m_l_types_8h_html"><div class="ttname"><a href="_s_b_m_l_types_8h.html">SBMLTypes.h</a></div><div class="ttdoc">Include all SBML types in a single header file.</div></div>
<div class="ttc" id="aclass_a_s_t_node_html"><div class="ttname"><a href="class_a_s_t_node.html">ASTNode</a></div><div class="ttdoc">\ @ @ . () mathematical expression.</div><div class="ttdef"><b>Definition:</b> ASTNode.h:221</div></div>
</div><!-- fragment --><p>The text-string form of mathematical formulas written by <a class="el" href="_formula_formatter_8cpp.html#a7621fa39bd34423ea59ed128bb17b6f4" title="Converts an AST to a string representation of a formula using a syntax basically derived from SBML Le...">SBML_formulaToString()</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for Doxygen -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Visit <a href="http://sbml.org">SBML.org</a> for more information
    about SBML and libSBML.
    </li>
   </ul>
</div>
</body>
</html>
